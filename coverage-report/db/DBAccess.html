<!DOCTYPE html>
<html>
<head>
  <title>DBAccess.java</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../coverage.css'/>
  <link rel='shortcut icon' type='image/png' href='../logo.png'/>
  <script type='text/javascript' src='../coverage.js'></script>
  <script type='text/javascript' src='../prettify.js'></script>
</head>
<body onload='prettyPrint()'>
  <table cellpadding='0' cellspacing='1'>
    <caption>api/src/db/DBAccess.java</caption>
    <tr>
      <td class='line'>1</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>package db;</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td><pre class='imports prettyprint' onclick='showHideLines(this)'><div>import java.sql.DriverManager;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.SQLTimeoutException;
import java.util.ArrayList;
import java.util.List;

import com.google.api.server.spi.response.InternalServerErrorException;
import com.google.api.server.spi.response.NotFoundException;
import com.google.appengine.api.utils.SystemProperty;

import java.sql.Statement;
</div><span>import ...</span></pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>17</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l17s0'>public class DBAccess {</pre></td>
    </tr>
    <tr>
      <td class='line'>18</td><td class='count'>1</td>
      <td><pre class='prettyprint covered' id='l18s0'>	private static String url = "jdbc:google:mysql://musictext-979:musictext1?user=root";</pre></td>
    </tr>
    <tr>
      <td class='line'>19</td><td class='count'>1</td>
      <td><pre class='prettyprint covered' id='l19s0'>	private static Connection conn;</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>21</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	private static void openConnection() throws SQLTimeoutException, InternalServerErrorException{</pre></td>
    </tr>
    <tr>
      <td class='line'>22</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>23</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l23s0' title='Executions: 0' class='uncovered'>if (SystemProperty.environment.value() ==</span></pre></td>
    </tr>
    <tr>
      <td class='line'>24</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l24s0'>					SystemProperty.Environment.Value.Production) {</pre></td>
    </tr>
    <tr>
      <td class='line'>25</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l25s0'>				Class.forName("com.mysql.jdbc.GoogleDriver");</pre></td>
    </tr>
    <tr>
      <td class='line'>26</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l26s0'>			} else {</pre></td>
    </tr>
    <tr>
      <td class='line'>27</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l27s0'>				Class.forName("com.mysql.jdbc.Driver");</pre></td>
    </tr>
    <tr>
      <td class='line'>28</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l28s0'>				url = "jdbc:mysql://localhost:3306/musictext?user=root";</pre></td>
    </tr>
    <tr>
      <td class='line'>29</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			} </pre></td>
    </tr>
    <tr>
      <td class='line'>30</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l30s0'>		} catch (ClassNotFoundException ex) {</pre></td>
    </tr>
    <tr>
      <td class='line'>31</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l31s0'>			throw new InternalServerErrorException("Internal jdbc library not found", ex);</pre></td>
    </tr>
    <tr>
      <td class='line'>32</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>33</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>34</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l34s0'>			conn = DriverManager.getConnection(url);</pre></td>
    </tr>
    <tr>
      <td class='line'>35</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l35s0'>		} catch (SQLException ex){</pre></td>
    </tr>
    <tr>
      <td class='line'>36</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l36s0'>			throw new SQLTimeoutException("DB not found");</pre></td>
    </tr>
    <tr>
      <td class='line'>37</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>38</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l38s0'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>40</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static List&lt;DBNetwork> getNetworks() </pre></td>
    </tr>
    <tr>
      <td class='line'>41</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws InternalServerErrorException, SQLTimeoutException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>43</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l43s0'>		List&lt;DBNetwork> nets = new ArrayList&lt;DBNetwork>();</pre></td>
    </tr>
    <tr>
      <td class='line'>44</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l44s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>45</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>46</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l46s0'>			ResultSet rs = conn.createStatement().executeQuery(</pre></td>
    </tr>
    <tr>
      <td class='line'>47</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l47s0'>					"SELECT id, network from musictext.B_Net;");</pre></td>
    </tr>
    <tr>
      <td class='line'>48</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l48s0'>			while(rs.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>49</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l49s0'>				nets.add(new DBNetwork(rs.getInt("id") , rs.getString("network")));</pre></td>
    </tr>
    <tr>
      <td class='line'>50</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>51</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l51s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>52</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l52s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>53</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l53s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>54</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>55</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l55s0'>		return nets;</pre></td>
    </tr>
    <tr>
      <td class='line'>56</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>58</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static DBNetwork getFullNetworks(int idNet, int idUser)</pre></td>
    </tr>
    <tr>
      <td class='line'>59</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, IllegalArgumentException, </pre></td>
    </tr>
    <tr>
      <td class='line'>60</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>62</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l62s0'>		DBNetwork net = null;</pre></td>
    </tr>
    <tr>
      <td class='line'>63</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l63s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>64</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try{</pre></td>
    </tr>
    <tr>
      <td class='line'>65</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l65s0'>			ResultSet rs = conn.createStatement().executeQuery(</pre></td>
    </tr>
    <tr>
      <td class='line'>66</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l66s0'>					"SELECT network from musictext.B_Net where id = " + idNet + ";");</pre></td>
    </tr>
    <tr>
      <td class='line'>67</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l67s0' title='Executions: 0' class='uncovered'>if (rs.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>68</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l68s0'>				net = new DBNetwork(idNet, rs.getString("network"));</pre></td>
    </tr>
    <tr>
      <td class='line'>69</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			else</pre></td>
    </tr>
    <tr>
      <td class='line'>70</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l70s0'>				throw new IllegalArgumentException("Network with id " + idNet + " does not exists");</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>72</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l72s0'>			String query = "SELECT id, node from musictext.B_Net_Node " + </pre></td>
    </tr>
    <tr>
      <td class='line'>73</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l73s0'>					" where id_net = " + idNet + " order by id;";</pre></td>
    </tr>
    <tr>
      <td class='line'>74</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			String query2;</pre></td>
    </tr>
    <tr>
      <td class='line'>75</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l75s0'>			ResultSet rs1 = conn.createStatement().executeQuery(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>76</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l76s0' title='Executions: 0' class='uncovered'>if (! rs1.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>77</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l77s0'>				throw new InternalServerErrorException("Network with id " + idNet + " has no node");</pre></td>
    </tr>
    <tr>
      <td class='line'>78</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l78s0'>			while(rs1.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>79</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l79s0'>				DBNode n = new DBNode(rs1.getInt("id"), rs1.getString("node"));</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>81</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l81s0'>				query2 = "Select id, outcome from musictext.B_Net_Outcome " +</pre></td>
    </tr>
    <tr>
      <td class='line'>82</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l82s0'>						" where id_node = " + rs1.getInt("id")  + " order by position;";</pre></td>
    </tr>
    <tr>
      <td class='line'>83</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l83s0'>				ResultSet rs2 = conn.createStatement().executeQuery(query2);</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>85</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>				<span id='l85s0' title='Executions: 0' class='uncovered'>if (! rs2.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>86</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l86s0'>					throw new InternalServerErrorException("Node with id " + n.getId() + " has no outcome");</pre></td>
    </tr>
    <tr>
      <td class='line'>87</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l87s0'>				while(rs2.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>88</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l88s0'>					n.addOutcome(new DBOutcome(rs2.getInt("id") , rs2.getString("outcome")));</pre></td>
    </tr>
    <tr>
      <td class='line'>89</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>				}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>91</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l91s0'>				query2 = "Select id_parent, node from musictext.B_Net_Parent p " +</pre></td>
    </tr>
    <tr>
      <td class='line'>92</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>						" inner join musictext.B_Net_Node n on id_parent=n.id " +</pre></td>
    </tr>
    <tr>
      <td class='line'>93</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l93s0'>						" where id_node = " + rs1.getInt("id")  + " order by position;";</pre></td>
    </tr>
    <tr>
      <td class='line'>94</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l94s0'>				rs2 = conn.createStatement().executeQuery(query2);</pre></td>
    </tr>
    <tr>
      <td class='line'>95</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l95s0'>				while(rs2.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>96</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l96s0'>					n.addParent(new DBNode(rs2.getInt("id_parent") , rs2.getString("node")));</pre></td>
    </tr>
    <tr>
      <td class='line'>97</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>				}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>99</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l99s0'>				query2 = "Select probability from musictext.B_Net_Prob " +</pre></td>
    </tr>
    <tr>
      <td class='line'>100</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l100s0'>						" where id_node = " + rs1.getInt("id")  + " and id_user = " + </pre></td>
    </tr>
    <tr>
      <td class='line'>101</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l101s0'>						idUser  + " order by position;";</pre></td>
    </tr>
    <tr>
      <td class='line'>102</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l102s0'>				rs2 = conn.createStatement().executeQuery(query2);</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>104</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>				<span id='l104s0' title='Executions: 0' class='uncovered'>if (! rs2.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>105</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l105s0'>					throw new InternalServerErrorException("Node with id " + n.getId() + " has no probability for user " + idUser);</pre></td>
    </tr>
    <tr>
      <td class='line'>106</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l106s0'>				while(rs2.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>107</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l107s0'>					n.addProbability(rs2.getDouble("probability"));</pre></td>
    </tr>
    <tr>
      <td class='line'>108</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>				}</pre></td>
    </tr>
    <tr>
      <td class='line'>109</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l109s0'>				net.addNodes(n);</pre></td>
    </tr>
    <tr>
      <td class='line'>110</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>111</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l111s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>112</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l112s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>113</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l113s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>114</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>115</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l115s0'>		return net;</pre></td>
    </tr>
    <tr>
      <td class='line'>116</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>118</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static List&lt;DBNode> getNodesOutcomes(int idNet)</pre></td>
    </tr>
    <tr>
      <td class='line'>119</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, IllegalArgumentException, </pre></td>
    </tr>
    <tr>
      <td class='line'>120</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException{</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>122</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l122s0'>		List&lt;DBNode> nodes = new ArrayList&lt;DBNode>();</pre></td>
    </tr>
    <tr>
      <td class='line'>123</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l123s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>124</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l124s0'>		String query = "SELECT id, node from musictext.B_Net_Node " + </pre></td>
    </tr>
    <tr>
      <td class='line'>125</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l125s0'>				" where id_net = " + idNet + ";";</pre></td>
    </tr>
    <tr>
      <td class='line'>126</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		String query2;</pre></td>
    </tr>
    <tr>
      <td class='line'>127</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		DBNode n;</pre></td>
    </tr>
    <tr>
      <td class='line'>128</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>129</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l129s0'>			ResultSet rs = conn.createStatement().executeQuery(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>130</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l130s0' title='Executions: 0' class='uncovered'>if (! rs.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>131</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l131s0'>				throw new IllegalArgumentException("Network with id " + idNet + " has no nodes");</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>133</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l133s0'>			while(rs.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>134</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l134s0'>				query2 = "Select id, outcome from musictext.B_Net_Outcome " +</pre></td>
    </tr>
    <tr>
      <td class='line'>135</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l135s0'>						" where id_node = " + rs.getInt("id")  + " order by position;";</pre></td>
    </tr>
    <tr>
      <td class='line'>136</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l136s0'>				n = new DBNode(rs.getInt("id") , rs.getString("node"));</pre></td>
    </tr>
    <tr>
      <td class='line'>137</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l137s0'>				ResultSet rs2 = conn.createStatement().executeQuery(query2);</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>139</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>				<span id='l139s0' title='Executions: 0' class='uncovered'>if (! rs.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>140</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l140s0'>					throw new InternalServerErrorException("Network with id " + idNet + " has no nodes");</pre></td>
    </tr>
    <tr>
      <td class='line'>141</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l141s0'>				while(rs2.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>142</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l142s0'>					n.addOutcome(new DBOutcome(rs2.getInt("id") , rs2.getString("outcome")));</pre></td>
    </tr>
    <tr>
      <td class='line'>143</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>				}</pre></td>
    </tr>
    <tr>
      <td class='line'>144</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l144s0'>				nodes.add(n);</pre></td>
    </tr>
    <tr>
      <td class='line'>145</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>146</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l146s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>147</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l147s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>148</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l148s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>149</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>150</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l150s0'>		return nodes;</pre></td>
    </tr>
    <tr>
      <td class='line'>151</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>153</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static List&lt;String> getNodes(int idNet)</pre></td>
    </tr>
    <tr>
      <td class='line'>154</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, IllegalArgumentException, </pre></td>
    </tr>
    <tr>
      <td class='line'>155</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>157</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l157s0'>		List&lt;String> nodes = new ArrayList&lt;String>();</pre></td>
    </tr>
    <tr>
      <td class='line'>158</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l158s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>159</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l159s0'>		String query = "SELECT id, node from musictext.B_Net_Node " + </pre></td>
    </tr>
    <tr>
      <td class='line'>160</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l160s0'>				" where id_net = " + idNet + ";";</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>162</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		ResultSet rs;</pre></td>
    </tr>
    <tr>
      <td class='line'>163</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>164</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l164s0'>			rs = conn.createStatement().executeQuery(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>165</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l165s0' title='Executions: 0' class='uncovered'>if (! rs.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>166</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l166s0'>				throw new IllegalArgumentException("Network with id " + idNet + " has no nodes");</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>168</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l168s0'>			while(rs.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>169</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l169s0'>				nodes.add(rs.getString("node"));</pre></td>
    </tr>
    <tr>
      <td class='line'>170</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>171</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l171s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>172</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l172s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>173</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l173s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>174</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>175</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l175s0'>		return nodes;</pre></td>
    </tr>
    <tr>
      <td class='line'>176</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>178</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static List&lt;String> getRules(int idNet, int idUser, boolean dynamic) </pre></td>
    </tr>
    <tr>
      <td class='line'>179</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, IllegalArgumentException,</pre></td>
    </tr>
    <tr>
      <td class='line'>180</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException{</pre></td>
    </tr>
    <tr>
      <td class='line'>181</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l181s0'>		List&lt;String> rules = new ArrayList&lt;String>();</pre></td>
    </tr>
    <tr>
      <td class='line'>182</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l182s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>183</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>184</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l184s0'>			String str = "SELECT id, rule from musictext.Rules where id_net = " +</pre></td>
    </tr>
    <tr>
      <td class='line'>185</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l185s0'>					idNet + " and (id_user = " + idUser + " and dynamic = ";</pre></td>
    </tr>
    <tr>
      <td class='line'>186</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l186s0' title='Executions: 0' class='uncovered'>str += dynamic</span> ? <span id='l186s1' title='Executions: 0' class='uncovered'>"1"</span> : <span id='l186s2' title='Executions: 0' class='uncovered'>"0";</span></pre></td>
    </tr>
    <tr>
      <td class='line'>187</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l187s0'>			str += ")";</pre></td>
    </tr>
    <tr>
      <td class='line'>188</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l188s0'>			ResultSet rs = conn.createStatement().executeQuery(str);</pre></td>
    </tr>
    <tr>
      <td class='line'>189</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l189s0' title='Executions: 0' class='uncovered'>if (! rs.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>190</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l190s0'>				throw new IllegalArgumentException("No rule for network " + idNet + " and user " + idUser);</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>192</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l192s0'>			while(rs.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>193</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l193s0'>				rules.add(rs.getString("rule"));</pre></td>
    </tr>
    <tr>
      <td class='line'>194</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>195</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l195s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>196</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l196s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>197</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l197s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>198</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>199</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l199s0'>		return rules;</pre></td>
    </tr>
    <tr>
      <td class='line'>200</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>202</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static void setRules(int idNet, int idUser, List&lt;String> rules) </pre></td>
    </tr>
    <tr>
      <td class='line'>203</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, IllegalArgumentException, </pre></td>
    </tr>
    <tr>
      <td class='line'>204</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException{</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>206</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>		<span id='l206s0' title='Executions: 0' class='uncovered'>if (rules.size()==0</span> || <span id='l206s1' title='Executions: 0' class='uncovered'>rules.contains(null))</span></pre></td>
    </tr>
    <tr>
      <td class='line'>207</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l207s0'>			throw new IllegalArgumentException("Rule list empty or invalid");</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>209</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l209s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>210</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>211</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l211s0'>			String queryDel = "delete from musictext.Rules where id_user = " + idUser + </pre></td>
    </tr>
    <tr>
      <td class='line'>212</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l212s0'>					" and id_net = " + idNet + " and dynamic = 1;";</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>214</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l214s0'>			String queryIns = "insert into musictext.Rules (id_net,id_user,position,dynamic,rule) values ";</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>216</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l216s0'>			for (int i = 0; i&lt;rules.size(); i++)</pre></td>
    </tr>
    <tr>
      <td class='line'>217</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l217s0'>				queryIns += new StringBuilder("(").append(idNet).append(",").append(idUser)</pre></td>
    </tr>
    <tr>
      <td class='line'>218</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l218s0'>				.append(",").append(i).append(",1,'").append(rules.get(i)).append("'),");</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>220</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l220s0'>			queryIns =  queryIns.substring(0, queryIns.length()-1) + ";";</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>222</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l222s0'>			conn.createStatement().executeUpdate(queryDel);</pre></td>
    </tr>
    <tr>
      <td class='line'>223</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l223s0'>			conn.createStatement().executeUpdate(queryIns);</pre></td>
    </tr>
    <tr>
      <td class='line'>224</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l224s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>225</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l225s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>226</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l226s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>227</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>228</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l228s0'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>230</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static DBUser getUserInfo(String name)</pre></td>
    </tr>
    <tr>
      <td class='line'>231</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, IllegalArgumentException, </pre></td>
    </tr>
    <tr>
      <td class='line'>232</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException, NotFoundException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>234</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>		<span id='l234s0' title='Executions: 0' class='uncovered'>if (name.contains("'"))</span></pre></td>
    </tr>
    <tr>
      <td class='line'>235</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l235s0'>			throw new IllegalArgumentException("User name contains special characters");</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>237</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l237s0'>		return getUser("name = '" + name + "'");</pre></td>
    </tr>
    <tr>
      <td class='line'>238</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>240</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static DBUser getUserInfo(int id) </pre></td>
    </tr>
    <tr>
      <td class='line'>241</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, NotFoundException, </pre></td>
    </tr>
    <tr>
      <td class='line'>242</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException{</pre></td>
    </tr>
    <tr>
      <td class='line'>243</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l243s0'>		return getUser("id = " + id);</pre></td>
    </tr>
    <tr>
      <td class='line'>244</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>246</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	private static DBUser getUser(String filter) </pre></td>
    </tr>
    <tr>
      <td class='line'>247</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, NotFoundException, </pre></td>
    </tr>
    <tr>
      <td class='line'>248</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>250</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		DBUser user;</pre></td>
    </tr>
    <tr>
      <td class='line'>251</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l251s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>252</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>253</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l253s0'>			String query = "SELECT id, name, age, gender from musictext.User where " + filter + ";";</pre></td>
    </tr>
    <tr>
      <td class='line'>254</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l254s0'>			ResultSet rs = conn.createStatement().executeQuery(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>255</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l255s0' title='Executions: 0' class='uncovered'>if(rs.next())</span>{</pre></td>
    </tr>
    <tr>
      <td class='line'>256</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l256s0'>				user = new DBUser(rs.getInt("id"), rs.getString("name"),</pre></td>
    </tr>
    <tr>
      <td class='line'>257</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l257s0'>						rs.getInt("age"), rs.getString("gender"));</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>259</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l259s0'>				query = "SELECT a.id, a.name from musictext.Top_Artists a inner join " + </pre></td>
    </tr>
    <tr>
      <td class='line'>260</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>						" musictext.User_Artists u on a.id = id_artist" +</pre></td>
    </tr>
    <tr>
      <td class='line'>261</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l261s0'>						" where id_user = " + rs.getInt("id") + ";";</pre></td>
    </tr>
    <tr>
      <td class='line'>262</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l262s0'>				ResultSet rs1 = conn.createStatement().executeQuery(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>263</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l263s0'>				while(rs1.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>264</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l264s0'>					user.addArtists(new DBArtist(rs1.getInt("id"), rs1.getString("name")));</pre></td>
    </tr>
    <tr>
      <td class='line'>265</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>				}</pre></td>
    </tr>
    <tr>
      <td class='line'>266</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l266s0'>			}else{</pre></td>
    </tr>
    <tr>
      <td class='line'>267</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l267s0'>				throw new NotFoundException("User " + filter);</pre></td>
    </tr>
    <tr>
      <td class='line'>268</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>269</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l269s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>270</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l270s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>271</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l271s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>272</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>273</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l273s0'>		return user;</pre></td>
    </tr>
    <tr>
      <td class='line'>274</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>276</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static List&lt;DBUser> getUserList() </pre></td>
    </tr>
    <tr>
      <td class='line'>277</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, InternalServerErrorException{</pre></td>
    </tr>
    <tr>
      <td class='line'>278</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l278s0'>		List&lt;DBUser> users = new ArrayList&lt;DBUser>();</pre></td>
    </tr>
    <tr>
      <td class='line'>279</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l279s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>280</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>281</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l281s0'>			String query = "SELECT id, name from musictext.User order by name;";</pre></td>
    </tr>
    <tr>
      <td class='line'>282</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l282s0'>			ResultSet rs = conn.createStatement().executeQuery(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>283</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l283s0' title='Executions: 0' class='uncovered'>if (rs.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>284</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l284s0'>				while(rs.next()){</pre></td>
    </tr>
    <tr>
      <td class='line'>285</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l285s0'>					users.add(new DBUser(rs.getInt("id"), rs.getString("name")));</pre></td>
    </tr>
    <tr>
      <td class='line'>286</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l286s0'>				}</pre></td>
    </tr>
    <tr>
      <td class='line'>287</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			else {</pre></td>
    </tr>
    <tr>
      <td class='line'>288</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l288s0'>				conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>289</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l289s0'>				throw new InternalServerErrorException("No user in the DB");</pre></td>
    </tr>
    <tr>
      <td class='line'>290</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>291</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l291s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>292</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l292s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>293</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l293s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>294</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>295</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l295s0'>		return users;</pre></td>
    </tr>
    <tr>
      <td class='line'>296</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>	/**
	 * Adds the user with &lt;i>name&lt;/i> to the database  
	 * @param name - The name of the user to be added
	 * @return The id of the user in the database.
	 * @throws InternalServerErrorException 
	 * @throws SQLTimeoutException 
	 * @throws NotFoundException 
	 * @throws Exception 
	 */</div><span>	/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>307</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static int addUser(String name) </pre></td>
    </tr>
    <tr>
      <td class='line'>308</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, IllegalArgumentException,</pre></td>
    </tr>
    <tr>
      <td class='line'>309</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>311</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>		<span id='l311s0' title='Executions: 0' class='uncovered'>if (name.contains("'"))</span></pre></td>
    </tr>
    <tr>
      <td class='line'>312</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l312s0'>			throw new IllegalArgumentException("User name contains special characters");</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>314</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l314s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>315</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>316</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l316s0'>			String query = "call musictext.SP_new_user ('" + name + "');";</pre></td>
    </tr>
    <tr>
      <td class='line'>317</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l317s0'>			ResultSet rs = conn.createStatement().executeQuery(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>318</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			int id;</pre></td>
    </tr>
    <tr>
      <td class='line'>319</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l319s0' title='Executions: 0' class='uncovered'>if(rs.next())</span>{</pre></td>
    </tr>
    <tr>
      <td class='line'>320</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l320s0'>				id = rs.getInt(1);</pre></td>
    </tr>
    <tr>
      <td class='line'>321</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l321s0'>				conn.close();</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>323</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>				<span id='l323s0' title='Executions: 0' class='uncovered'>if (id == -1)</span></pre></td>
    </tr>
    <tr>
      <td class='line'>324</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l324s0'>					throw new IllegalArgumentException("User already exists");</pre></td>
    </tr>
    <tr>
      <td class='line'>325</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l325s0'>				return id;</pre></td>
    </tr>
    <tr>
      <td class='line'>326</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			} else {</pre></td>
    </tr>
    <tr>
      <td class='line'>327</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l327s0'>				conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>328</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l328s0'>				throw new InternalServerErrorException("SQL procedure internal error");</pre></td>
    </tr>
    <tr>
      <td class='line'>329</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>330</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l330s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>331</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l331s0'>			throw new InternalServerErrorException("Internal SQL Error\n" + e.getMessage(), e);</pre></td>
    </tr>
    <tr>
      <td class='line'>332</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>333</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>335</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static void editUser(DBUser user) </pre></td>
    </tr>
    <tr>
      <td class='line'>336</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, InternalServerErrorException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>338</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l338s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>339</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>340</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l340s0'>			Statement stmnt = conn.createStatement();</pre></td>
    </tr>
    <tr>
      <td class='line'>341</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l341s0'>			String query = "";</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>343</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l343s0' title='Executions: 0' class='uncovered'>if (user.getAge() != null)</span> {</pre></td>
    </tr>
    <tr>
      <td class='line'>344</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l344s0'>				query = "update musictext.User SET age = " + user.getAge()</pre></td>
    </tr>
    <tr>
      <td class='line'>345</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l345s0'>						+ " where id = " + user.getId() + ";";</pre></td>
    </tr>
    <tr>
      <td class='line'>346</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l346s0'>				stmnt.addBatch(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>347</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr>
      <td class='line'>348</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l348s0' title='Executions: 0' class='uncovered'>if (user.getGender() != null)</span>{</pre></td>
    </tr>
    <tr>
      <td class='line'>349</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l349s0'>				query = "update musictext.User SET gender ='" + user.getGender() </pre></td>
    </tr>
    <tr>
      <td class='line'>350</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l350s0'>						+ "' where id = " + user.getId() + ";";</pre></td>
    </tr>
    <tr>
      <td class='line'>351</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l351s0'>				stmnt.addBatch(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>352</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>354</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l354s0'>			query = "delete from musictext.User_Artists where id_user = " + user.getId() + ";";</pre></td>
    </tr>
    <tr>
      <td class='line'>355</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l355s0'>			stmnt.addBatch(query);</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>357</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l357s0' title='Executions: 0' class='uncovered'>if (user.getArtists() != null</span> && <span id='l357s1' title='Executions: 0' class='uncovered'>user.getArtists().size()>0)</span></pre></td>
    </tr>
    <tr>
      <td class='line'>358</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l358s0'>				for (DBArtist a:user.getArtists()){</pre></td>
    </tr>
    <tr>
      <td class='line'>359</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l359s0'>					query = "insert into musictext.User_Artists (id_artist,id_user) values (" + </pre></td>
    </tr>
    <tr>
      <td class='line'>360</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l360s0'>							a.getId() + ", " + user.getId() + ");";</pre></td>
    </tr>
    <tr>
      <td class='line'>361</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l361s0'>					stmnt.addBatch(query);</pre></td>
    </tr>
    <tr>
      <td class='line'>362</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l362s0'>				} else {</pre></td>
    </tr>
    <tr>
      <td class='line'>363</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l363s0'>					throw new IllegalArgumentException("At least an artist in the list");</pre></td>
    </tr>
    <tr>
      <td class='line'>364</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>				}</pre></td>
    </tr>
    <tr>
      <td class='line'>365</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l365s0'>			stmnt.executeBatch();</pre></td>
    </tr>
    <tr>
      <td class='line'>366</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l366s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>367</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l367s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>368</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l368s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>369</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>370</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l370s0'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>372</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static List&lt;Integer> getTags(String tagCluster) </pre></td>
    </tr>
    <tr>
      <td class='line'>373</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, IllegalArgumentException, </pre></td>
    </tr>
    <tr>
      <td class='line'>374</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			InternalServerErrorException, NotFoundException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>376</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l376s0'>		List&lt;Integer> tags = new ArrayList&lt;Integer>();</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>378</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>		<span id='l378s0' title='Executions: 0' class='uncovered'>if (tagCluster == null</span> || <span id='l378s1' title='Executions: 0' class='uncovered'>tagCluster== ""</span> || <span id='l378s2' title='Executions: 0' class='uncovered'>tagCluster.contains("'"))</span></pre></td>
    </tr>
    <tr>
      <td class='line'>379</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l379s0'>			throw new IllegalArgumentException("Non valid tag cluster");</pre></td>
    </tr>
    <tr>
      <td class='line'>380</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l380s0'>		String query = "";</pre></td>
    </tr>
    <tr>
      <td class='line'>381</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l381s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>382</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>383</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l383s0'>			query = "SELECT id_tag from musictext.Cluster_Tag " + </pre></td>
    </tr>
    <tr>
      <td class='line'>384</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l384s0'>					" where cluster_tag like '" + tagCluster + "';";</pre></td>
    </tr>
    <tr>
      <td class='line'>385</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l385s0'>			ResultSet rs = conn.createStatement().executeQuery(query);</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>387</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>			<span id='l387s0' title='Executions: 0' class='uncovered'>if (rs.first())</span></pre></td>
    </tr>
    <tr>
      <td class='line'>388</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l388s0'>				while(rs.next())</pre></td>
    </tr>
    <tr>
      <td class='line'>389</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l389s0'>					tags.add(rs.getInt("id_tag"));</pre></td>
    </tr>
    <tr>
      <td class='line'>390</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			else</pre></td>
    </tr>
    <tr>
      <td class='line'>391</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l391s0'>				throw new NotFoundException("Cluster tag " + tagCluster + "\n" + query);</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>393</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l393s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>394</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l394s0'>		} catch (SQLException e) {</pre></td>
    </tr>
    <tr>
      <td class='line'>395</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l395s0'>			throw new InternalServerErrorException("Internal SQL Error", e);</pre></td>
    </tr>
    <tr>
      <td class='line'>396</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		}</pre></td>
    </tr>
    <tr>
      <td class='line'>397</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l397s0'>		return tags;</pre></td>
    </tr>
    <tr>
      <td class='line'>398</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>400</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	public static boolean isConnected() </pre></td>
    </tr>
    <tr>
      <td class='line'>401</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>			throws SQLTimeoutException, InternalServerErrorException {</pre></td>
    </tr>
    <tr>
      <td class='line'>402</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l402s0'>		openConnection();</pre></td>
    </tr>
    <tr>
      <td class='line'>403</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>		try {</pre></td>
    </tr>
    <tr>
      <td class='line'>404</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l404s0'>			conn.close();</pre></td>
    </tr>
    <tr>
      <td class='line'>405</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l405s0'>		} catch (SQLException e) { }</pre></td>
    </tr>
    <tr>
      <td class='line'>406</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l406s0'>		return true;</pre></td>
    </tr>
    <tr>
      <td class='line'>407</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>	}</pre></td>
    </tr>
    <tr>
      <td class='line'>408</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>}</pre></td>
    </tr>
  </table>
</body>
</html>
